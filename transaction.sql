DROP TABLE IF EXISTS address;
DROP TABLE IF EXISTS city_loc;
DROP TABLE IF EXISTS customer;
DROP TABLE IF EXISTS merchant;
DROP TABLE IF EXISTS transaction;

CREATE TABLE address (
	id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
	acct_num INT8 NOT NULL UNIQUE,
	street STRING(64) NOT NULL,
	zip INT4 NOT NULL,
	lat FLOAT NOT NULL,
	lng FLOAT NOT NULL
);

CREATE TABLE city_loc (
	id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
	zip INT4 NOT NULL UNIQUE,
	city STRING(32) NOT NULL,
	state STRING(2) NOT NULL,
	city_pop INT4 NOT NULL
);

CREATE TABLE customer (
	id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
	ssn STRING(16) NOT NULL UNIQUE,
	cc_num INT8 NOT NULL,
	first STRING(16) NOT NULL,
	last STRING(16) NOT NULL,
	gender STRING(1) NOT NULL,
	job STRING(64) NOT NULL,
	dob DATE NOT NULL,
	acct_num INT8 NOT NULL,
	profile STRING(32) NOT NULL
);

CREATE TABLE merchant (
	id UUID PRIMARY KEY,
	merchant STRING(64) NOT NULL,
	merch_lat FLOAT NOT NULL,
	merch_lng FLOAT NOT NULL
);

CREATE TABLE transaction (
	id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
	cc_num INT8 NOT NULL,
	merch_id UUID NOT NULL,
	trans_num STRING(32) NOT NULL,
	trans_date DATE NOT NULL,
	trans_time TIME NOT NULL,
	unix_time INT4 NOT NULL,
	category STRING(16) NOT NULL,
	amt FLOAT NOT NULL,
	is_fraud BOOL NOT NULL
);

ALTER TABLE transaction SPLIT AT VALUES
	('10000000-0000-0000-0000-000000000000'),
	('20000000-0000-0000-0000-000000000000'),
	('30000000-0000-0000-0000-000000000000'),
	('40000000-0000-0000-0000-000000000000'),
	('50000000-0000-0000-0000-000000000000'),
	('60000000-0000-0000-0000-000000000000'),
	('70000000-0000-0000-0000-000000000000'),
	('80000000-0000-0000-0000-000000000000'),
	('90000000-0000-0000-0000-000000000000'),
	('A0000000-0000-0000-0000-000000000000'),
	('B0000000-0000-0000-0000-000000000000'),
	('C0000000-0000-0000-0000-000000000000'),
	('D0000000-0000-0000-0000-000000000000'),
	('E0000000-0000-0000-0000-000000000000'),
	('F0000000-0000-0000-0000-000000000000');

SET CLUSTER SETTING kv.rangefeed.enabled = true;
